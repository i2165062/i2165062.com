<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Web90 â€” Create Your On-Chain Page</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.10.0/ethers.umd.min.js"></script>
<style>
  body {
    background:#e6e6e6;
    font-family:Tahoma, sans-serif;
    max-width:800px;
    margin:40px auto;
    padding:20px;
    border:4px double #333;
    background-image:url('https://i.imgur.com/ybD1aSm.gif'); /* Ø¯Ù‡Ù‡ Û¹Û° vibes ğŸ˜„ */
  }
  h1 { text-align:center; }
  textarea { width:100%; height:150px; }
  input, button { padding:10px; font-size:16px; width:100%; margin-top:8px; }
  #preview { border:2px solid #444; margin-top:20px; width:100%; height:300px; background:white; }
</style>
</head>
<body>

<h1>ğŸŒ Web90 â€” On-Chain HTML Page</h1>

<button id="connectBtn">ğŸ”Œ Connect MetaMask</button>

<h3>Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡:</h3>
<input id="titleInput" placeholder="Ù…Ø«Ù„Ø§Ù‹: My 90s Page">

<h3>HTML ØµÙØ­Ù‡:</h3>
<textarea id="htmlInput"><h1>Hello Web90!</h1><p>This is my on-chain page.</p></textarea>

<button id="publishBtn">ğŸš€ Publish to Blockchain</button>

<h3>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡</h3>
<iframe id="preview"></iframe>

<script>
const CONTRACT_ADDRESS = "0x73511669fd4dE447feD18BB79bAFeAC93aB7F31f";
const RPC = "http://188.209.138.136:8545";

// ABI ÙÙ‚Ø· Ù‡Ù…Ø§Ù† Ø³Ù‡ ØªØ§Ø¨Ø¹ Ú©Ù‡ Ù„Ø§Ø²Ù… Ø¯Ø§Ø±ÛŒÙ…
const ABI = [
  "function createOrUpdatePage(string title, string html) external",
  "function getPage(address owner) view returns (string title, string html, uint256 lastUpdate)"
];

let provider;
let signer;
let contract;

document.getElementById('connectBtn').onclick = async () => {
  await window.ethereum.request({ method: 'eth_requestAccounts' });

  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  alert("MetaMask Connected!");
};

// Publish
document.getElementById('publishBtn').onclick = async () => {
  if (!signer) return alert("Ø§ÙˆÙ„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø±Ø§ ÙˆØµÙ„ Ú©Ù†!");

  const title = document.getElementById('titleInput').value;
  const html = document.getElementById('htmlInput').value;

  const tx = await contract.createOrUpdatePage(title, html);
  alert("â³ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯... ØµØ¨Ø± Ú©Ù†");
  await tx.wait();
  alert("âœ… ØµÙØ­Ù‡ Ø±ÙˆÛŒ Ø¨Ù„Ø§Ú©â€ŒÚ†ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!");

  loadMyPage();
};

// Load
async function loadMyPage() {
  if (!signer) return;

  const addr = await signer.getAddress();
  const result = await contract.getPage(addr);

  const html = result[1];

  document.getElementById('preview').srcdoc = html;
}

</script>
</body>
</html>
